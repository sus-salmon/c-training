# IO Test Framework - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## –û–±–∑–æ—Ä

IO Test Framework - —ç—Ç–æ –ª–µ–≥–∫–∏–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º –Ω–∞ C —á–µ—Ä–µ–∑ stdin/stdout. –û—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–µ–Ω –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö, –∫–æ—Ç–æ—Ä—ã–µ –µ—â–µ –Ω–µ –≥–æ—Ç–æ–≤—ã –∫ –Ω–∞–ø–∏—Å–∞–Ω–∏—é —á–∏—Å—Ç—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –∏ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞—é—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏–≤—ã—á–Ω—ã–µ `scanf` –∏ `printf`.

‚ö†Ô∏è **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã:** –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ macOS. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã `fork()`, `pipe()`, `execl()`, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –≤ Windows.

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- **–ü—Ä–æ—Å—Ç–æ—Ç–∞**: –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã —Ç–∞–∫, –∫–∞–∫ –∏—Ö –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- **–†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç—å**: –¢–µ—Å—Ç—ã –æ—Ç—Ä–∞–∂–∞—é—Ç —Ä–µ–∞–ª—å–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ø—Ä–æ–≥—Ä–∞–º–º–æ–π
- **–î—Ä—É–∂–µ–ª—é–±–Ω–æ—Å—Ç—å –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö**: –ù–µ —Ç—Ä–µ–±—É–µ—Ç –ø–æ–Ω–∏–º–∞–Ω–∏—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π —á–∏—Å—Ç—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- **–¶–≤–µ—Ç–Ω–æ–π –≤—ã–≤–æ–¥**: –ù–∞–≥–ª—è–¥–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–æ–≤
- **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**: –õ–µ–≥–∫–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è –≤ makefile

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

–§—Ä–µ–π–º–≤–æ—Ä–∫ —É–∂–µ –≤–∫–ª—é—á–µ–Ω –≤ –ø—Ä–æ–µ–∫—Ç –∫–∞–∫ –∑–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–π —Ñ–∞–π–ª `third_party/io_test/io_test.h`.

## –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –í–∫–ª—é—á–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–π —Ñ–∞–π–ª

```c
#include "../../../../third_party/io_test/io_test.h"
```

### 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–∞

```c
int main(void) {
    // –ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç
    IO_TEST_BEGIN("–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞");

    // –î–æ–±–∞–≤–∏—Ç—å –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—Ç–æ, —á—Ç–æ –≤–≤–æ–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
    IO_TEST_INPUT("5.0\n+\n3.0\n");

    // –û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥ –ø—Ä–æ–≥—Ä–∞–º–º—ã
    IO_TEST_EXPECT_OUTPUT("–í–≤–µ–¥–∏—Ç–µ –ø–µ—Ä–≤–æ–µ —á–∏—Å–ª–æ: –í–≤–µ–¥–∏—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏—é (+, -, *, /): –í–≤–µ–¥–∏—Ç–µ –≤—Ç–æ—Ä–æ–µ —á–∏—Å–ª–æ: –†–µ–∑—É–ª—å—Ç–∞—Ç: 8.00\n");

    // –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ—Å—Ç
    IO_TEST_END();

    // –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã
    IO_TEST_RUN_ALL("./build/program-name");

    return 0;
}
```

## –ú–∞–∫—Ä–æ—Å—ã API

### `IO_TEST_BEGIN(test_name)`

–ù–∞—á–∏–Ω–∞–µ—Ç –Ω–æ–≤—ã–π —Ç–µ—Å—Ç —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º –∏–º–µ–Ω–µ–º.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**

- `test_name` - —Å—Ç—Ä–æ–∫–∞ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º —Ç–µ—Å—Ç–∞

### `IO_TEST_INPUT(input_str)`

–î–æ–±–∞–≤–ª—è–µ—Ç –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —Ç–µ—Å—Ç–∞. –ú–æ–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –±–æ–ª—å—à–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**

- `input_str` - —Å—Ç—Ä–æ–∫–∞ —Å –≤—Ö–æ–¥–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (–≤–∫–ª—é—á–∞—è `\n` –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –Ω–∞ –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É)

### `IO_TEST_EXPECT_OUTPUT(output_str)`

–£–∫–∞–∑—ã–≤–∞–µ—Ç –æ–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥ –ø—Ä–æ–≥—Ä–∞–º–º—ã. –ú–æ–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –±–æ–ª—å—à–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ–∂–∏–¥–∞–µ–º–æ–≥–æ –≤—ã–≤–æ–¥–∞.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**

- `output_str` - —Å—Ç—Ä–æ–∫–∞ —Å –æ–∂–∏–¥–∞–µ–º—ã–º –≤—ã–≤–æ–¥–æ–º

### `IO_TEST_END()`

–ó–∞–≤–µ—Ä—à–∞–µ—Ç —Ç–µ–∫—É—â–∏–π —Ç–µ—Å—Ç.

### `IO_TEST_RUN_ALL(program_path)`

–ó–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –∏ –≤—ã–≤–æ–¥–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**

- `program_path` - –ø—É—Ç—å –∫ –∏—Å–ø–æ–ª–Ω—è–µ–º–æ–º—É —Ñ–∞–π–ª—É –ø—Ä–æ–≥—Ä–∞–º–º—ã

## –ü—Ä–∏–º–µ—Ä: –ü—Ä–æ—Å—Ç–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä

### main.c

```c
#include <stdio.h>

int main(void) {
    double a, b;
    char op;

    printf("–í–≤–µ–¥–∏—Ç–µ –ø–µ—Ä–≤–æ–µ —á–∏—Å–ª–æ: ");
    scanf("%lf", &a);

    printf("–í–≤–µ–¥–∏—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏—é (+, -, *, /): ");
    scanf(" %c", &op);

    printf("–í–≤–µ–¥–∏—Ç–µ –≤—Ç–æ—Ä–æ–µ —á–∏—Å–ª–æ: ");
    scanf("%lf", &b);

    switch (op) {
        case '+':
            printf("–†–µ–∑—É–ª—å—Ç–∞—Ç: %.2f\n", a + b);
            break;
        case '-':
            printf("–†–µ–∑—É–ª—å—Ç–∞—Ç: %.2f\n", a - b);
            break;
        // ... –¥—Ä—É–≥–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
        default:
            printf("–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è\n");
    }

    return 0;
}
```

### test.c

```c
#include "../../../../third_party/io_test/io_test.h"

int main(void) {
    IO_TEST_BEGIN("–°–ª–æ–∂–µ–Ω–∏–µ");
    IO_TEST_INPUT("5.0\n+\n3.0\n");
    IO_TEST_EXPECT_OUTPUT("–í–≤–µ–¥–∏—Ç–µ –ø–µ—Ä–≤–æ–µ —á–∏—Å–ª–æ: –í–≤–µ–¥–∏—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏—é (+, -, *, /): –í–≤–µ–¥–∏—Ç–µ –≤—Ç–æ—Ä–æ–µ —á–∏—Å–ª–æ: –†–µ–∑—É–ª—å—Ç–∞—Ç: 8.00\n");
    IO_TEST_END();

    IO_TEST_BEGIN("–î–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å");
    IO_TEST_INPUT("5.0\n/\n0.0\n");
    IO_TEST_EXPECT_OUTPUT("–í–≤–µ–¥–∏—Ç–µ –ø–µ—Ä–≤–æ–µ —á–∏—Å–ª–æ: –í–≤–µ–¥–∏—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏—é (+, -, *, /): –í–≤–µ–¥–∏—Ç–µ –≤—Ç–æ—Ä–æ–µ —á–∏—Å–ª–æ: –û—à–∏–±–∫–∞: –¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å\n");
    IO_TEST_END();

    IO_TEST_RUN_ALL("./build/calculator");
    return 0;
}
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Makefile

–î–æ–±–∞–≤—å—Ç–µ –≤ makefile —Ü–µ–ª—å –¥–ª—è —Å–±–æ—Ä–∫–∏ —Ç–µ—Å—Ç–æ–≤:

```makefile
$(TESTBIN): $(TEST_C) $(HDRS)
	@mkdir -p $(BUILD)
	$(CC) $(CFLAGS) $(SANFLAGS) $(INCLUDES) $(TEST_C) -o $(TESTBIN)

.PHONY: test
test: build $(TESTBIN)
	./$(TESTBIN)
```

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ**: –í—ã–≤–æ–¥ –¥–æ–ª–∂–µ–Ω —Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –æ–∂–∏–¥–∞–µ–º—ã–º, –≤–∫–ª—é—á–∞—è –ø—Ä–æ–±–µ–ª—ã –∏ –ø–µ—Ä–µ–≤–æ–¥—ã —Å—Ç—Ä–æ–∫
2. **–ü—Ä–æ—Å—Ç—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã**: –§—Ä–µ–π–º–≤–æ—Ä–∫ –ª—É—á—à–µ –≤—Å–µ–≥–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –∫–æ–Ω—Å–æ–ª—å–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º
3. **–†–∞–∑–º–µ—Ä –≤—ã–≤–æ–¥–∞**: –û–≥—Ä–∞–Ω–∏—á–µ–Ω —Ä–∞–∑–º–µ—Ä–æ–º –±—É—Ñ–µ—Ä–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 4KB –¥–ª—è –≤—ã–≤–æ–¥–∞)

## –°–æ–≤–µ—Ç—ã –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

1. **–ë—É–¥—å—Ç–µ —Ç–æ—á–Ω—ã —Å –≤—ã–≤–æ–¥–æ–º**: –í–∫–ª—é—á–∞–π—Ç–µ –≤—Å–µ –ø—Ä–æ–±–µ–ª—ã, –¥–≤–æ–µ—Ç–æ—á–∏—è –∏ –ø–µ—Ä–µ–≤–æ–¥—ã —Å—Ç—Ä–æ–∫
2. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏**: –í–∫–ª—é—á–∞–π—Ç–µ —Ç–µ—Å—Ç—ã –Ω–∞ –æ—à–∏–±–∫–∏ –∏ –æ—Å–æ–±—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏
3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Å–º—ã—Å–ª–µ–Ω–Ω—ã–µ –∏–º–µ–Ω–∞**: –î–∞–≤–∞–π—Ç–µ —Ç–µ—Å—Ç–∞–º –ø–æ–Ω—è—Ç–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è
4. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –≤—ã–≤–æ–¥**: –ï—Å–ª–∏ —Ç–µ—Å—Ç –ø–∞–¥–∞–µ—Ç, –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ —Å—Ä–∞–≤–Ω–∏—Ç–µ –æ–∂–∏–¥–∞–µ–º—ã–π –∏ —Ä–µ–∞–ª—å–Ω—ã–π –≤—ã–≤–æ–¥

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

–§—Ä–µ–π–º–≤–æ—Ä–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞:

- macOS

–¢—Ä–µ–±—É–µ—Ç:

- C11 –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä (clang)
- POSIX —Å–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã (fork, pipe, execl)

## –¶–≤–µ—Ç–Ω–æ–π –≤—ã–≤–æ–¥

–§—Ä–µ–π–º–≤–æ—Ä–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ANSI escape –∫–æ–¥—ã –¥–ª—è —Ü–≤–µ—Ç–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞:

- üü¢ –ó–µ–ª–µ–Ω—ã–π –¥–ª—è –ø—Ä–æ–π–¥–µ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
- üî¥ –ö—Ä–∞—Å–Ω—ã–π –¥–ª—è –ø—Ä–æ–≤–∞–ª–µ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
- üîµ –°–∏–Ω–∏–π –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
- üü° –ñ–µ–ª—Ç—ã–π –¥–ª—è –¥–µ—Ç–∞–ª–µ–π –æ—à–∏–±–æ–∫
